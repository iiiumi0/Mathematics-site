<!DOCTYPE html>
<html lang="kk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ–Ω—ñ“£ –ø—Ä–æ—Ñ–∏–ª—ñ–º - –ö”©“£—ñ–ª–¥—ñ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
        }
        
        body {
            background-color: #f0f9ff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .profile-container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            color: #ff7b9c;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: #ff7b9c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(255, 123, 156, 0.3);
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(255, 123, 156, 0.4);
        }
        
        /* –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞ */
        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ff7b9c, #ff9a8b);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 10px rgba(255, 123, 156, 0.3);
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(255, 123, 156, 0.4);
        }
        
        .profile-card {
            background: white;
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0, 0, 150, 0.1);
            margin-bottom: 30px;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 30px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        
        .avatar-section {
            text-align: center;
        }
        
        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            border: 5px solid #ff7b9c;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .profile-avatar:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 123, 156, 0.4);
        }
        
        .change-avatar-btn {
            background-color: #6ab1ff;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }
        
        .change-avatar-btn:hover {
            background-color: #5aa0ff;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            color: #ff7b9c;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .profile-details {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 20px;
        }
        
        .detail-item {
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detail-item i {
            color: #6ab1ff;
            width: 20px;
        }
        
        .edit-btn {
            background: none;
            border: none;
            color: #6ab1ff;
            cursor: pointer;
            font-size: 0.9rem;
            margin-left: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s;
        }
        
        .edit-btn:hover {
            color: #ff7b9c;
            transform: translateY(-2px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: #f9fdff;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            border: 3px solid #e6f2ff;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        
        .stat-value {
            font-size: 2.5rem;
            color: #6ab1ff;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 1.1rem;
        }
        
        .trophy { color: #ffcc00; }
        .clock { color: #7bff7b; }
        .chart { color: #ff7b9c; }
        .target { color: #6ab1ff; }
        
        .section-title {
            color: #6ab1ff;
            font-size: 1.8rem;
            margin: 40px 0 20px;
            padding-bottom: 10px;
            border-bottom: 3px dashed #ff7b9c;
        }
        
        .game-history {
            background: white;
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 150, 0.1);
            margin-bottom: 30px;
        }
        
        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .history-table th {
            background-color: #f0f9ff;
            color: #6ab1ff;
            padding: 15px;
            text-align: left;
            font-size: 1.1rem;
        }
        
        .history-table td {
            padding: 15px;
            border-bottom: 1px solid #eee;
            color: #666;
        }
        
        .history-table tr:hover {
            background-color: #f9fdff;
        }
        
        .difficulty-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .badge-easy { background-color: #e6ffe6; color: #2ecc71; }
        .badge-medium { background-color: #fff9e6; color: #f39c12; }
        .badge-hard { background-color: #ffe6e6; color: #e74c3c; }
        
        .percentage-good { color: #2ecc71; font-weight: bold; }
        .percentage-medium { color: #f39c12; font-weight: bold; }
        .percentage-low { color: #e74c3c; font-weight: bold; }
        
        .activity-visit {
            color: #6ab1ff;
            font-weight: bold;
            background-color: #f0f9ff;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.85rem;
        }
        
        .progress-chart {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .chart-container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        }
        
        .chart-title {
            color: #666;
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .chart-bar {
            height: 20px;
            background-color: #eee;
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
        }
        
        .chart-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease-in-out;
        }
        
        .chart-label {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #666;
        }
        
        .no-data {
            text-align: center;
            color: #999;
            font-size: 1.2rem;
            padding: 40px;
            background-color: #f9fdff;
            border-radius: 20px;
            border: 2px dashed #ddd;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            flex: 1;
            min-width: 200px;
            background: linear-gradient(135deg, #6ab1ff, #a3d5ff);
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.2rem;
            border-radius: 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(106, 177, 255, 0.3);
        }
        
        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(106, 177, 255, 0.4);
        }
        
        .action-btn.play {
            background: linear-gradient(135deg, #ff7b9c, #ff9a8b);
        }
        
        .action-btn.reset {
            background: linear-gradient(135deg, #ffcc00, #ffdd44);
        }
        
        .action-btn.about {
            background: linear-gradient(135deg, #a855f7, #c084fc);
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            display: none;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
        }
        
        .modal-title {
            color: #ff7b9c;
            font-size: 1.8rem;
            margin-bottom: 15px;
        }
        
        .modal-message {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.5;
        }
        
        .modal-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e6f2ff;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        
        .modal-input:focus {
            outline: none;
            border-color: #6ab1ff;
            box-shadow: 0 0 0 3px rgba(106, 177, 255, 0.2);
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .modal-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            flex: 1;
        }
        
        .modal-btn.confirm {
            background: linear-gradient(135deg, #6ab1ff, #a3d5ff);
            color: white;
        }
        
        .modal-btn.cancel {
            background: #f0f0f0;
            color: #666;
        }
        
        .modal-btn.danger {
            background: linear-gradient(135deg, #ff7b9c, #ff9a8b);
            color: white;
        }
        
        .modal-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        /* –†–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –ø–æ–ª–∞ */
        .gender-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .gender-option {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .gender-radio {
            width: 18px;
            height: 18px;
        }
        
        @media (max-width: 768px) {
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-card, .game-history {
                padding: 20px;
            }
            
            .history-table {
                font-size: 0.9rem;
            }
            
            .history-table th, .history-table td {
                padding: 10px;
            }
            
            .action-btn {
                min-width: 100%;
            }
            
            .logout-btn {
                position: relative;
                top: auto;
                right: auto;
                margin-top: 20px;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <button class="back-btn" id="backButton">
        ‚Üê –ê—Ä—Ç“õ–∞
    </button>
    
    <button class="logout-btn" id="logoutButton">
        üö™ –®—ã“ì—É
    </button>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã—Ö–æ–¥–∞ -->
    <div class="modal-overlay" id="logoutModal">
        <div class="modal-content">
            <h3 class="modal-title">–®—ã“ì—É —Ä–∞—Å—Ç–∞—É—ã</h3>
            <p class="modal-message" id="logoutMessage">
                –°—ñ–∑ —à—ã–Ω—ã–º–µ–Ω –∞–∫–∫–∞—É–Ω—Ç—ã“£—ã–∑–¥–∞–Ω —à—ã“ì—ã–ø –∫–µ—Ç–∫—ñ“£—ñ–∑ –∫–µ–ª–µ –º–µ?
            </p>
            <div class="modal-buttons">
                <button class="modal-btn danger" id="confirmLogout">–ò”ô, —à—ã“ì—É</button>
                <button class="modal-btn cancel" id="cancelLogout">–ñ–æ“õ, “õ–∞–ª—É</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏ -->
    <div class="modal-overlay" id="nameModal">
        <div class="modal-content">
            <h3 class="modal-title">–ê—Ç—ã“£—ã–∑–¥—ã ”©–∑–≥–µ—Ä—Ç—É</h3>
            <input type="text" class="modal-input" id="newNameInput" placeholder="–ñ–∞“£–∞ –∞—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" maxlength="20">
            <div class="modal-buttons">
                <button class="modal-btn confirm" id="saveNameBtn">–°–∞“õ—Ç–∞—É</button>
                <button class="modal-btn cancel" id="cancelNameBtn">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ–∑—Ä–∞—Å—Ç–∞ -->
    <div class="modal-overlay" id="ageModal">
        <div class="modal-content">
            <h3 class="modal-title">–ñ–∞—Å—ã“£—ã–∑–¥—ã ”©–∑–≥–µ—Ä—Ç—É</h3>
            <input type="number" class="modal-input" id="newAgeInput" placeholder="–ñ–∞—Å—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑" min="4" max="12">
            <div class="modal-buttons">
                <button class="modal-btn confirm" id="saveAgeBtn">–°–∞“õ—Ç–∞—É</button>
                <button class="modal-btn cancel" id="cancelAgeBtn">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–ª–∞ -->
    <div class="modal-overlay" id="genderModal">
        <div class="modal-content">
            <h3 class="modal-title">–ñ—ã–Ω—ã—Å—ã“£—ã–∑–¥—ã ”©–∑–≥–µ—Ä—Ç—É</h3>
            <div class="gender-options">
                <label class="gender-option">
                    <input type="radio" name="gender" value="“∞–ª –±–∞–ª–∞" class="gender-radio" id="genderBoy">
                    <span>“∞–ª –±–∞–ª–∞</span>
                </label>
                <label class="gender-option">
                    <input type="radio" name="gender" value="“ö—ã–∑ –±–∞–ª–∞" class="gender-radio" id="genderGirl">
                    <span>“ö—ã–∑ –±–∞–ª–∞</span>
                </label>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn confirm" id="saveGenderBtn">–°–∞“õ—Ç–∞—É</button>
                <button class="modal-btn cancel" id="cancelGenderBtn">–ë–æ–ª–¥—ã—Ä–º–∞—É</button>
            </div>
        </div>
    </div>
    
    <div class="profile-container">
        <div class="header">
            <h1>–ú–µ–Ω—ñ“£ –ü—Ä–æ—Ñ–∏–ª—ñ–º</h1>
        </div>
        
        <div class="profile-card">
            <div class="profile-header">
                <div class="avatar-section">
                    <img id="profileAvatar" class="profile-avatar" src="" alt="–ê–≤–∞—Ç–∞—Ä">
                    <button class="change-avatar-btn" id="changeAvatarBtn">
                        –ê–≤–∞—Ç–∞—Ä–¥—ã ”©–∑–≥–µ—Ä—Ç—É
                    </button>
                    <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                </div>
                
                <div class="profile-info">
                    <h2 class="profile-name" id="profileName">–ë–∞–ª–∞</h2>
                    <div class="profile-details">
                        <div class="detail-item">
                            <span>üë§ –ê—Ç—ã: <span id="userNameText">–ë–∞–ª–∞</span></span>
                            <button class="edit-btn" id="editNameBtn">
                                ‚úèÔ∏è ”®–∑–≥–µ—Ä—Ç—É
                            </button>
                        </div>
                        <div class="detail-item">
                            <span>üéÇ –ñ–∞—Å—ã: <span id="userAge">7</span> –∂–∞—Å—Ç–∞</span>
                            <button class="edit-btn" id="editAgeBtn">
                                ‚úèÔ∏è ”®–∑–≥–µ—Ä—Ç—É
                            </button>
                        </div>
                        <div class="detail-item">
                            <span>‚ö• –ñ—ã–Ω—ã—Å—ã: <span id="userGender">“∞–ª –±–∞–ª–∞</span></span>
                            <button class="edit-btn" id="editGenderBtn">
                                ‚úèÔ∏è ”®–∑–≥–µ—Ä—Ç—É
                            </button>
                        </div>
                        <div class="detail-item">
                            <span>üìÖ –¢—ñ—Ä–∫–µ–ª–≥–µ–Ω: <span id="regDate">–ë“Ø–≥—ñ–Ω</span></span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon trophy">
                        üèÜ
                    </div>
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">–ë–∞—Ä–ª—ã“õ “õ–∞—Ç—ã—Å—É–ª–∞—Ä</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon trophy">
                        ‚≠ê
                    </div>
                    <div class="stat-value" id="bestScore">0%</div>
                    <div class="stat-label">–ï“£ –∂–∞“õ—Å—ã –Ω”ô—Ç–∏–∂–µ</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon clock">
                        ‚è±Ô∏è
                    </div>
                    <div class="stat-value" id="tableVisits">0</div>
                    <div class="stat-label">–ö–µ—Å—Ç–µ–≥–µ –±–∞—Ä—É</div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-icon target">
                        üéØ
                    </div>
                    <div class="stat-value" id="countVisits">0</div>
                    <div class="stat-label">–°–∞–Ω–∞—É“ì–∞ –±–∞—Ä—É</div>
                </div>
            </div>
        </div>
        
        <h3 class="section-title">–ë–∞—Ä–ª—ã“õ “õ—ã–∑–º–µ—Ç—Ç–µ—Ä —Ç–∞—Ä–∏—Ö—ã</h3>
        <div class="game-history">
            <div id="historyTableContainer">
                <!-- –¢–∞–±–ª–∏—Ü–∞ —Å –∏—Å—Ç–æ—Ä–∏–µ–π –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <h3 class="section-title">–ë–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞—Å—ã</h3>
        <div class="progress-chart" id="progressChart">
            <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å -->
        </div>
        
        <div class="action-buttons">
            <button class="action-btn play" id="playButton">
                üéÆ –û–π–Ω–∞—É–¥—ã –∂–∞–ª“ì–∞—Å—Ç—ã—Ä—É
            </button>
            <button class="action-btn" id="homeButton">
                üè† –ë–∞—Å—Ç—ã –±–µ—Ç–∫–µ
            </button>
            <button class="action-btn about" id="aboutButton">
                ‚ÑπÔ∏è –ë—ñ–∑ —Ç—É—Ä–∞–ª—ã
            </button>
            <button class="action-btn reset" id="resetButton">
                üóëÔ∏è –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞–Ω—ã —Ç–∞–∑–∞–ª–∞—É
            </button>
        </div>
    </div>

    <script>
        // URL –ø–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä—ñ
        const urlParams = new URLSearchParams(window.location.search);
        let username = urlParams.get('username') || '–ë–∞–ª–∞';
        let age = urlParams.get('age') || 7;
        
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ
        let userData = {
            name: username,
            age: age,
            gender: '“∞–ª –±–∞–ª–∞',
            registrationDate: new Date().toLocaleDateString('kk-KZ')
        };
        
        // –°–ª–æ–≤–∞—Ä—å –Ω–∞–∑–≤–∞–Ω–∏–π –∑–∞–Ω—è—Ç–∏–π –Ω–∞ –∫–∞–∑–∞—Ö—Å–∫–æ–º
        const lessonNames = {
            'addition': '“ö–æ—Å—É',
            'subtraction': '–ê–ª—É',
            'multiplication': '–ö”©–±–µ–π—Ç—É',
            'division': '–ë”©–ª—É',
            'table': '–ö”©–±–µ–π—Ç—É –∫–µ—Å—Ç–µ—Å—ñ',
            'brackets': '–ñ–∞“õ—à–∞–º–µ–Ω –∂“±–º—ã—Å',
            'mixed': '–ê—Ä–∞–ª–∞—Å –µ—Å–µ–ø—Ç–µ—Ä',
            'count': '–ñ–∞–ª–ø—ã —Å–∞–Ω–∞—É'
        };
        
        // –ë–µ—Ç—Ç—ñ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è–ª–∞—É
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            loadAllActivityHistory();
            updateStatistics();
            loadActivityCharts();
            
            // –ö–Ω–æ–ø–∫–∞–ª–∞—Ä“ì–∞ ”ô—Å–µ—Ä –µ—Ç—É
            initEventListeners();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function initEventListeners() {
            // –ö–Ω–æ–ø–∫–∞ "–ê—Ä—Ç“õ–∞" - –ò–°–ü–†–ê–í–õ–ï–ù–û
            document.getElementById('backButton').addEventListener('click', function() {
                // –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –Ω–∞ lessons.html
                window.location.href = `lessons.html?username=${encodeURIComponent(userData.name)}&age=${userData.age}`;
            });
            
            // –ö–Ω–æ–ø–∫–∞ –≤—ã—Ö–æ–¥–∞
            document.getElementById('logoutButton').addEventListener('click', function() {
                showLogoutModal();
            });
            
            // –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã—Ö–æ–¥–∞
            document.getElementById('confirmLogout').addEventListener('click', logoutUser);
            document.getElementById('cancelLogout').addEventListener('click', function() {
                document.getElementById('logoutModal').style.display = 'none';
            });
            
            // –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            document.getElementById('playButton').addEventListener('click', function() {
                window.location.href = `lessons.html?username=${encodeURIComponent(userData.name)}&age=${userData.age}`;
            });
            
            document.getElementById('homeButton').addEventListener('click', function() {
                window.location.href = `index.html?username=${encodeURIComponent(userData.name)}&age=${userData.age}`;
            });
            
            // –ö–Ω–æ–ø–∫–∞ "–ë—ñ–∑ —Ç—É—Ä–∞–ª—ã" - –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É onas.html
            document.getElementById('aboutButton').addEventListener('click', function() {
                window.location.href = `onas.html?username=${encodeURIComponent(userData.name)}&age=${userData.age}`;
            });
            
            document.getElementById('resetButton').addEventListener('click', function() {
                if (confirm('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞–Ω—ã —Ç–∞–∑–∞–ª–∞“ì—ã“£—ã–∑ –∫–µ–ª–µ –º–µ? –ë“±–ª ”ô—Ä–µ–∫–µ—Ç—Ç—ñ –±–æ–ª–¥—ã—Ä–º–∞—É –º“Ø–º–∫—ñ–Ω –µ–º–µ—Å.')) {
                    localStorage.removeItem('gameHistory');
                    localStorage.removeItem('bestScores');
                    localStorage.removeItem('visitHistory');
                    alert('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–∞–∑–∞–ª–∞–Ω–¥—ã!');
                    loadAllActivityHistory();
                    updateStatistics();
                    loadActivityCharts();
                }
            });
            
            // –ê–≤–∞—Ç–∞—Ä–¥—ã ”©–∑–≥–µ—Ä—Ç—É
            document.getElementById('changeAvatarBtn').addEventListener('click', function() {
                document.getElementById('avatarInput').click();
            });
            
            document.getElementById('avatarInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        const avatarData = e.target.result;
                        localStorage.setItem('userAvatar', avatarData);
                        document.getElementById('profileAvatar').src = avatarData;
                        alert('–ê–≤–∞—Ç–∞—Ä —Å”ô—Ç—Ç—ñ ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ!');
                    }
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // –ê–≤–∞—Ç–∞—Ä–¥—ã –∫–ª–∏–∫ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            document.getElementById('profileAvatar').addEventListener('click', function() {
                document.getElementById('avatarInput').click();
            });
            
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–º–µ–Ω–∏
            document.getElementById('editNameBtn').addEventListener('click', function() {
                document.getElementById('newNameInput').value = userData.name;
                document.getElementById('nameModal').style.display = 'flex';
            });
            
            document.getElementById('saveNameBtn').addEventListener('click', function() {
                const newName = document.getElementById('newNameInput').value.trim();
                if (newName && newName.length >= 2) {
                    userData.name = newName;
                    localStorage.setItem('userName', newName);
                    updateUserInfo();
                    document.getElementById('nameModal').style.display = 'none';
                    alert('–ê—Ç—ã“£—ã–∑ —Å”ô—Ç—Ç—ñ ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ!');
                } else {
                    alert('–ê—Ç—ã“£—ã–∑ –∫–µ–º—ñ–Ω–¥–µ 2 ”ô—Ä—ñ–ø—Ç–µ–Ω —Ç“±—Ä—É—ã –∫–µ—Ä–µ–∫!');
                }
            });
            
            document.getElementById('cancelNameBtn').addEventListener('click', function() {
                document.getElementById('nameModal').style.display = 'none';
            });
            
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–∑—Ä–∞—Å—Ç–∞
            document.getElementById('editAgeBtn').addEventListener('click', function() {
                document.getElementById('newAgeInput').value = userData.age;
                document.getElementById('ageModal').style.display = 'flex';
            });
            
            document.getElementById('saveAgeBtn').addEventListener('click', function() {
                const newAge = parseInt(document.getElementById('newAgeInput').value);
                if (newAge >= 4 && newAge <= 12) {
                    userData.age = newAge;
                    localStorage.setItem('userAge', newAge);
                    updateUserInfo();
                    document.getElementById('ageModal').style.display = 'none';
                    alert('–ñ–∞—Å—ã“£—ã–∑ —Å”ô—Ç—Ç—ñ ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ!');
                } else {
                    alert('–ñ–∞—Å—ã“£—ã–∑ 4 –ø–µ–Ω 12 –∞—Ä–∞—Å—ã–Ω–¥–∞ –±–æ–ª—É—ã –∫–µ—Ä–µ–∫!');
                }
            });
            
            document.getElementById('cancelAgeBtn').addEventListener('click', function() {
                document.getElementById('ageModal').style.display = 'none';
            });
            
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–∞
            document.getElementById('editGenderBtn').addEventListener('click', function() {
                // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
                if (userData.gender === '“∞–ª –±–∞–ª–∞') {
                    document.getElementById('genderBoy').checked = true;
                } else {
                    document.getElementById('genderGirl').checked = true;
                }
                document.getElementById('genderModal').style.display = 'flex';
            });
            
            document.getElementById('saveGenderBtn').addEventListener('click', function() {
                const selectedGender = document.querySelector('input[name="gender"]:checked');
                if (selectedGender) {
                    userData.gender = selectedGender.value;
                    localStorage.setItem('userGender', selectedGender.value);
                    updateUserInfo();
                    document.getElementById('genderModal').style.display = 'none';
                    alert('–ñ—ã–Ω—ã—Å—ã“£—ã–∑ —Å”ô—Ç—Ç—ñ ”©–∑–≥–µ—Ä—Ç—ñ–ª–¥—ñ!');
                }
            });
            
            document.getElementById('cancelGenderBtn').addEventListener('click', function() {
                document.getElementById('genderModal').style.display = 'none';
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
        }
        
        // –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ–Ω –∂“Ø–∫—Ç–µ—É
        function loadUserData() {
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ localStorage
            const savedName = localStorage.getItem('userName');
            const savedAge = localStorage.getItem('userAge');
            const savedGender = localStorage.getItem('userGender');
            const savedRegDate = localStorage.getItem('userRegDate');
            
            // –û–±–Ω–æ–≤–∏—Ç—å userData
            if (savedName) userData.name = savedName;
            if (savedAge) userData.age = savedAge;
            if (savedGender) userData.gender = savedGender;
            if (savedRegDate) userData.registrationDate = savedRegDate;
            else {
                userData.registrationDate = new Date().toLocaleDateString('kk-KZ');
                localStorage.setItem('userRegDate', userData.registrationDate);
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            updateUserInfo();
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        function updateUserInfo() {
            // –ò–º—è
            document.getElementById('profileName').textContent = userData.name;
            document.getElementById('userNameText').textContent = userData.name;
            document.getElementById('userAge').textContent = userData.age;
            document.getElementById('userGender').textContent = userData.gender;
            document.getElementById('regDate').textContent = userData.registrationDate;
            
            // –°–æ–æ–±—â–µ–Ω–∏–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ –≤—ã—Ö–æ–¥–∞
            document.getElementById('logoutMessage').textContent = 
                `${userData.name}, —Å—ñ–∑ —à—ã–Ω—ã–º–µ–Ω –∞–∫–∫–∞—É–Ω—Ç—ã“£—ã–∑–¥–∞–Ω —à—ã“ì—ã–ø –∫–µ—Ç–∫—ñ“£—ñ–∑ –∫–µ–ª–µ –º–µ?`;
            
            // –ê–≤–∞—Ç–∞—Ä–¥—ã –∂“Ø–∫—Ç–µ—É
            loadAvatar();
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä
        function loadAvatar() {
            const savedAvatar = localStorage.getItem('userAvatar');
            const avatarImg = document.getElementById('profileAvatar');
            
            if (savedAvatar) {
                avatarImg.src = savedAvatar;
                avatarImg.style.display = 'block';
                avatarImg.style.backgroundColor = 'transparent';
                avatarImg.style.color = 'transparent';
                avatarImg.textContent = '';
            } else {
                // ”ò–¥–µ–ø–∫—ñ –∞–≤–∞—Ç–∞—Ä (—Ç–µ–∫—Å—Ç—Ç—ñ–∫ –≤–µ—Ä—Å–∏—è)
                avatarImg.alt = userData.name;
                avatarImg.style.backgroundColor = '#6ab1ff';
                avatarImg.style.display = 'flex';
                avatarImg.style.alignItems = 'center';
                avatarImg.style.justifyContent = 'center';
                avatarImg.style.color = 'white';
                avatarImg.style.fontWeight = 'bold';
                avatarImg.style.fontSize = '40px';
                avatarImg.textContent = userData.name.charAt(0).toUpperCase();
                avatarImg.src = '';
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        function loadAllActivityHistory() {
            const gameHistory = JSON.parse(localStorage.getItem('gameHistory') || '[]');
            const visitHistory = JSON.parse(localStorage.getItem('visitHistory') || '[]');
            const container = document.getElementById('historyTableContainer');
            
            if (gameHistory.length === 0 && visitHistory.length === 0) {
                container.innerHTML = '<div class="no-data">”ò–ª—ñ –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ —Ç–∞—Ä–∏—Ö—ã –∂–æ“õ. –û–π—ã–Ω –æ–π–Ω–∞“£—ã–∑ –Ω–µ–º–µ—Å–µ —Å–∞–±–∞“õ—Ç–∞—Ä–¥—ã “õ–∞—Ä–∞“£—ã–∑!</div>';
                return;
            }
            
            // –û–±—ä–µ–¥–∏–Ω—è–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä –∏ –ø–æ—Å–µ—â–µ–Ω–∏–π
            let allActivities = [];
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∏–≥—Ä—ã
            gameHistory.forEach(game => {
                allActivities.push({
                    type: 'game',
                    date: game.date,
                    lesson: game.lesson,
                    difficulty: game.difficulty,
                    score: game.score,
                    totalTasks: game.totalTasks,
                    percentage: game.percentage,
                    time: game.time
                });
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ—Å–µ—â–µ–Ω–∏—è
            visitHistory.forEach(visit => {
                allActivities.push({
                    type: 'visit',
                    date: visit.date,
                    lesson: visit.lesson,
                    duration: visit.duration || 0
                });
            });
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ (–Ω–æ–≤—ã–µ —Å–Ω–∞—á–∞–ª–∞)
            allActivities.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
            const recentActivities = allActivities.slice(0, 15);
            
            let html = `
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>–ö“Ø–Ω—ñ</th>
                            <th>–°–∞–±–∞“õ/“ö—ã–∑–º–µ—Ç</th>
                            <th>–¢“Ø—Ä—ñ</th>
                            <th>–ù”ô—Ç–∏–∂–µ/–ö“Ø–π</th>
                            <th>“ö–æ—Å—ã–º—à–∞ –∞“õ–ø–∞—Ä–∞—Ç</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            recentActivities.forEach(activity => {
                const date = new Date(activity.date).toLocaleDateString('kk-KZ');
                const time = new Date(activity.date).toLocaleTimeString('kk-KZ', { hour: '2-digit', minute: '2-digit' });
                const lessonName = lessonNames[activity.lesson] || activity.lesson;
                
                let typeCell = '';
                let resultCell = '';
                let infoCell = '';
                
                if (activity.type === 'game') {
                    // –û–π—ã–Ω–¥–∞—Ä
                    const difficultyName = getDifficultyName(activity.difficulty);
                    const difficultyClass = getDifficultyClass(activity.difficulty);
                    const timeFormatted = formatTime(activity.time);
                    const percentageClass = getPercentageClass(activity.percentage);
                    
                    typeCell = `<span class="difficulty-badge ${difficultyClass}">${difficultyName} –æ–π—ã–Ω</span>`;
                    resultCell = `<span class="${percentageClass}">${activity.score}/${activity.totalTasks} (${activity.percentage}%)</span>`;
                    infoCell = `‚è±Ô∏è ${timeFormatted}`;
                } else {
                    // –ü–æ—Å–µ—â–µ–Ω–∏—è (—Ç–∞–±–ª–∏—Ü–∞, —Å—á–µ—Ç)
                    typeCell = '<span class="activity-visit">üëÅÔ∏è “ö–∞—Ä–∞—É</span>';
                    resultCell = 'üëÅÔ∏è “ö–∞—Ä–∞–ª–¥—ã';
                    if (activity.duration > 0) {
                        infoCell = `‚è±Ô∏è ${formatTime(activity.duration)} —É–∞“õ—ã—Ç –±–æ–ª–¥—ã`;
                    } else {
                        infoCell = '“ö—ã—Å“õ–∞ “õ–∞—Ä–∞—É';
                    }
                }
                
                html += `
                    <tr>
                        <td>${date}<br><small>${time}</small></td>
                        <td>${lessonName}</td>
                        <td>${typeCell}</td>
                        <td>${resultCell}</td>
                        <td>${infoCell}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }
        
        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞–Ω—ã –∂–∞“£–∞—Ä—Ç—É
        function updateStatistics() {
            const gameHistory = JSON.parse(localStorage.getItem('gameHistory') || '[]');
            const visitHistory = JSON.parse(localStorage.getItem('visitHistory') || '[]');
            const bestScores = JSON.parse(localStorage.getItem('bestScores') || '{}');
            
            // –ë–∞—Ä–ª—ã“õ “õ–∞—Ç—ã—Å—É–ª–∞—Ä (–æ–π—ã–Ω–¥–∞—Ä + “õ–∞—Ä–∞—É–ª–∞—Ä)
            const totalActivities = gameHistory.length + visitHistory.length;
            document.getElementById('totalGames').textContent = totalActivities;
            
            // –ï“£ –∂–∞“õ—Å—ã –Ω”ô—Ç–∏–∂–µ (—Ç–æ–ª—å–∫–æ –∏–∑ –∏–≥—Ä)
            let bestPercentage = 0;
            Object.values(bestScores).forEach(score => {
                if (score.percentage > bestPercentage) {
                    bestPercentage = score.percentage;
                }
            });
            document.getElementById('bestScore').textContent = bestPercentage + '%';
            
            // –ö–µ—Å—Ç–µ–≥–µ –±–∞—Ä—É —Å–∞–Ω—ã
            const tableVisits = visitHistory.filter(v => v.lesson === 'table').length;
            document.getElementById('tableVisits').textContent = tableVisits;
            
            // –°–∞–Ω–∞—É“ì–∞ –±–∞—Ä—É —Å–∞–Ω—ã
            const countVisits = visitHistory.filter(v => v.lesson === 'count').length;
            document.getElementById('countVisits').textContent = countVisits;
        }
        
        // –ñ“Ø–∫—Ç–µ—É –≥—Ä–∞—Ñ–∏–∫—Ç–µ—Ä—ñ –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ –±–æ–π—ã–Ω—à–∞
        function loadActivityCharts() {
            const gameHistory = JSON.parse(localStorage.getItem('gameHistory') || '[]');
            const visitHistory = JSON.parse(localStorage.getItem('visitHistory') || '[]');
            const container = document.getElementById('progressChart');
            
            if (gameHistory.length === 0 && visitHistory.length === 0) {
                container.innerHTML = '<div class="no-data">”ò–ª—ñ –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞—Å—ã –∂–æ“õ. –û–π—ã–Ω–¥–∞—Ä –æ–π–Ω–∞“£—ã–∑ –Ω–µ–º–µ—Å–µ —Å–∞–±–∞“õ—Ç–∞—Ä–¥—ã “õ–∞—Ä–∞“£—ã–∑!</div>';
                return;
            }
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ —Ç“Ø—Ä–ª–µ—Ä—ñ –±–æ–π—ã–Ω—à–∞
            const activityTypes = {
                'game': { name: '–û–π—ã–Ω–¥–∞—Ä', count: 0 },
                'visit': { name: '“ö–∞—Ä–∞—É–ª–∞—Ä', count: 0 }
            };
            
            activityTypes['game'].count = gameHistory.length;
            activityTypes['visit'].count = visitHistory.length;
            
            // –°–∞–±–∞“õ—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ –±–∞—Ä–ª—ã“õ –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫
            const lessonActivity = {};
            
            // –û–π—ã–Ω–¥–∞—Ä –±–æ–π—ã–Ω—à–∞
            gameHistory.forEach(game => {
                if (!lessonActivity[game.lesson]) {
                    lessonActivity[game.lesson] = { 
                        name: lessonNames[game.lesson] || game.lesson,
                        games: 0,
                        visits: 0
                    };
                }
                lessonActivity[game.lesson].games += 1;
            });
            
            // “ö–∞—Ä–∞—É–ª–∞—Ä –±–æ–π—ã–Ω—à–∞
            visitHistory.forEach(visit => {
                if (!lessonActivity[visit.lesson]) {
                    lessonActivity[visit.lesson] = { 
                        name: lessonNames[visit.lesson] || visit.lesson,
                        games: 0,
                        visits: 0
                    };
                }
                lessonActivity[visit.lesson].visits += 1;
            });
            
            let html = '';
            
            // –ë–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ —Ç“Ø—Ä–ª–µ—Ä—ñ –±–æ–π—ã–Ω—à–∞ –≥—Ä–∞—Ñ–∏–∫
            html += '<div class="chart-container">';
            html += '<h4 class="chart-title">–ë–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ —Ç“Ø—Ä–ª–µ—Ä—ñ</h4>';
            
            Object.entries(activityTypes).forEach(([key, stat]) => {
                if (stat.count > 0) {
                    const totalActivities = gameHistory.length + visitHistory.length;
                    const percentage = Math.round((stat.count / totalActivities) * 100);
                    
                    html += `
                        <div class="chart-item">
                            <div class="chart-label">
                                <span>${stat.name}</span>
                                <span>${stat.count} (${percentage}%)</span>
                            </div>
                            <div class="chart-bar">
                                <div class="chart-fill" style="width: ${percentage}%; background-color: ${key === 'game' ? '#6ab1ff' : '#ff7b9c'};"></div>
                            </div>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            
            // –°–∞–±–∞“õ—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫ –≥—Ä–∞—Ñ–∏–≥—ñ
            html += '<div class="chart-container">';
            html += '<h4 class="chart-title">–°–∞–±–∞“õ—Ç–∞—Ä –±–æ–π—ã–Ω—à–∞ –±–µ–ª—Å–µ–Ω–¥—ñ–ª—ñ–∫</h4>';
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –æ–±—â–µ–º—É –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
            const sortedLessons = Object.entries(lessonActivity)
                .sort((a, b) => (b[1].games + b[1].visits) - (a[1].games + a[1].visits));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–ø-5
            const topLessons = sortedLessons.slice(0, 5);
            
            // –ù–∞—Ö–æ–¥–∏–º –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
            const maxActivity = Math.max(...topLessons.map(([_, stat]) => stat.games + stat.visits));
            
            topLessons.forEach(([key, stat]) => {
                const totalActivity = stat.games + stat.visits;
                const percentage = Math.round((totalActivity / maxActivity) * 100);
                
                html += `
                    <div class="chart-item">
                        <div class="chart-label">
                            <span>${stat.name}</span>
                            <span>${totalActivity} (${stat.games} –æ–π—ã–Ω, ${stat.visits} “õ–∞—Ä–∞—É)</span>
                        </div>
                        <div class="chart-bar">
                            <div class="chart-fill" style="width: ${percentage}%; background-color: #00b894;"></div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            container.innerHTML = html;
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤
            setTimeout(() => {
                document.querySelectorAll('.chart-fill').forEach(fill => {
                    const width = fill.style.width;
                    fill.style.width = '0%';
                    setTimeout(() => {
                        fill.style.width = width;
                    }, 100);
                });
            }, 300);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã—Ö–æ–¥–∞
        function showLogoutModal() {
            document.getElementById('logoutModal').style.display = 'flex';
        }
        
        // –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        function logoutUser() {
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–µ—Å—Å–∏—é
            const lastSession = {
                date: new Date().toISOString(),
                page: 'profile.html',
                username: userData.name
            };
            localStorage.setItem('lastSession', JSON.stringify(lastSession));
            
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            window.location.href = 'index.html';
        }
        
        // –ö”©–º–µ–∫—à—ñ —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä
        function getDifficultyName(difficulty) {
            const difficulties = {
                'easy': '–ñ–µ“£—ñ–ª',
                'medium': '–û—Ä—Ç–∞—à–∞',
                'hard': '“ö–∏—ã–Ω'
            };
            return difficulties[difficulty] || difficulty;
        }
        
        function getDifficultyClass(difficulty) {
            const classes = {
                'easy': 'badge-easy',
                'medium': 'badge-medium',
                'hard': 'badge-hard'
            };
            return classes[difficulty] || '';
        }
        
        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }
        
        function getPercentageClass(percentage) {
            if (percentage >= 80) return 'percentage-good';
            if (percentage >= 60) return 'percentage-medium';
            return 'percentage-low';
        }
    </script>
</body>
</html>
